<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scalping Bot Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
        td, th {
            text-align: center;
        }
        .container {
            display: flex;
        }
        .half {
            width: 50%;
            padding: 20px;
        }
        .log {
            background-color: #f9f9f9;
            padding: 10px;
            height: 490px;
            overflow-y: scroll;
        }
        .eth-price {
            font-size: 20px;
            color: #007BFF;
            margin-left: 20px;
        }
        .state-table {
            width: 40%;
            margin-top: 10px;
            border: 1px solid black;
            border-collapse: collapse;
        }
        .state-table th, .state-table td {
            padding: 8px;
            border: 1px solid black;
            text-align: center;
        }
        .state-table th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <!-- Τίτλος και τιμή Ethereum -->
    <h1>Scalping Bot Dashboard
        <span class="eth-price">Loading ETH price...</span>
    </h1>

    <!-- State File Data σε Πίνακα -->
    <table class="state-table" id="state_file_table">
        <thead>
            <tr>
                <th>Variable</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <!-- Τα δεδομένα του state.json θα εμφανιστούν εδώ -->
        </tbody>
    </table>

    <div class="container">
        <!-- Πρώτο μέρος: Πίνακας μεταβλητών -->
        <div class="half">
            <h2>Scalping Variables</h2>
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Value</th>
                        <th>Explanation</th>
                    </tr>
                </thead>
                <tbody id="variable-table">
                    <!-- Τα δεδομένα θα γεμίσουν με AJAX -->
                </tbody>
            </table>
        </div>

        <!-- Δεύτερο μέρος: Log αρχείο -->
        <div class="half">
            <h2>Log File (Last 20 lines)</h2>
            <div class="log" id="log-content">
                <!-- Το log θα γεμίσει με AJAX -->
            </div>
        </div>
    </div>

    <script>
        function loadVariables() {
            $.getJSON("/get_variables", function(data) {
                var table_html = "";
                $.each(data, function(key, value) {
                    table_html += "<tr><td>" + key + "</td><td>" + value + "</td></tr>";
                });
                $("#variables_table tbody").html(table_html);
            });
        }
				
				function loadVariables() {
					$.ajax({
						url: "/get_variables",
						type: "GET",
						success: function(data) {
							$('#variable-table').html(`
								<tr><td colspan="3"><strong>Initial Variables</strong></td></tr>
								<tr><td>SCALP_TARGET</td><td>${data.SCALP_TARGET}</td><td>Scalp ${(data.SCALP_TARGET * 100 - 100).toFixed(2)}%</td></tr>
								<tr><td>MAX_DAILY_TRADES</td><td>${data.MAX_TRADES_PER_DAY}</td><td>Maximum daily trades</td></tr>

								<tr><td colspan="3"><strong>Risk Management</strong></td></tr>
								<tr><td>Price Drop Limit</td><td>${data.STOP_LOSS}</td><td>Price drop limit at ${(data.STOP_LOSS * 100).toFixed(2)}%</td></tr>
								<tr><td>Trailing Profit Threshold</td><td>${data.TRAILING_PROFIT_THRESHOLD}</td><td>Trailing profit threshold at ${(data.TRAILING_PROFIT_THRESHOLD * 100).toFixed(2)}%</td></tr>
								<tr><td colspan="3"><strong>Trades</strong></td></tr>
								<tr><td>Quantity</td><td>${data.TRADE_AMOUNT}</td><td>Trade quantity</td></tr>
								<tr><td colspan="3"><strong>Technical Indicators</strong></td></tr>
								<tr><td>Show MA Period</td><td>${data.short_ma_period}</td><td>Show MA Period</td></tr>
								<tr><td>Long MA Period</td><td>${data.long_ma_period}</td><td>Long MA Period</td></tr>
								<tr><td>RSI Threshold</td><td>${data.RSI_THRESHOLD}</td><td>RSI Threshold</td></tr>

							`);
						},
						error: function(error) {
							console.log("Error fetching variables:", error);
						}
					});
				}				

        function loadLogs() {
            $.getJSON("/get_logs", function(data) {
                var log_html = "";
                $.each(data, function(index, value) {
                    log_html += "<li>" + value + "</li>";
                });
                $("#log-content").html(log_html);
            });
        }

        function fetchEthPrice() {
            $.getJSON("/api/eth_price", function(data) {
                if (data.eth_price) {
                    $('.eth-price').text(`ETH Price: €${data.eth_price}`);
                } else {
                    $('.eth-price').text("Unable to fetch ETH price");
                }
            });
        }

        function fetchStateFileData() {
            $.getJSON("/get_state_file_data", function(data) {
                var table_html = "";
                $.each(data, function(key, value) {
                    table_html += "<tr><td>" + key + "</td><td>" + value + "</td></tr>";
                });
                $("#state_file_table tbody").html(table_html);
            });
        }

        setInterval(loadVariables, 30000);
        setInterval(loadLogs, 10000);
        setInterval(fetchEthPrice, 30000);
        setInterval(fetchStateFileData, 60000);

        $(document).ready(function() {
            loadVariables();
            loadLogs();
            fetchEthPrice();
            fetchStateFileData();
        });
    </script>

</body>
</html>
